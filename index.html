<!--
 https://www.frog-pod.com/FrogTechLog/2023/01/cssmix-blend-mode.html
 
  -->

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">    
	<meta name="description" content="Ishigame65のトップページ">
	<meta property="og:url" content="https://ishigame65.netlify.app/">
	<meta property="og:type" content="website">
	<meta property="og:title" content="Ishigame65">
	<meta property="og:description" content="イシガメが快適に暮らす環境を作る">
	<meta property="og:image" content="https://ishigame65.netlify.app/img/ig1080x1080b.jpg">
	<link rel="shortcut icon" href="img/kame.ico">
	<title>Ishigame65</title>
</head>
<style>
    section#movies {
        display: flex;
        /* justify-content: space-between; */
    }
    #main_movie {
        position: relative;
        margin-left: auto;
        margin-right: auto;
    }
    #catchphrase {
		background: none;
        position:absolute;
        top: 0;
        left: 0;
        right: 0;
        margin: auto;
        z-index: 10;
        text-align: center;
        width: fit-content;
        padding: 0 1em;
        background-color: rgba(128,128,0,0.5);
        color: whitesmoke;
        font-weight: normal;
        font-size: x-large;
        font-family:'Times New Roman', Times, serif;
        filter: sepia(100%);
    }
    #movie {
        max-width: 640px;
        filter: sepia(100%);
        border-radius: 0.2em;
    }
    #buttons {
        text-align: center;
    }
    #buttons button {
        margin-left: 0.5em;
        padding: 0.2em 0.5em;
        border: 1px solid gray;
    }
    #mbut0 {
        background-color: DeepSkyBlue;
    }
    #mbut1, #mbut2, #mbut3, #mbut4, #mbut5 {
        background-color: khaki;
    }
    button#auto {
        border: none;
        background-color: rgba(255,255,255,0.0);
        color: DodgerBlue;
        scale: 1.7 1.4;
        margin-right: 0.3em;
    }
    /* 検索 */
    section#search {
        margin-top: 0.5em;
        background: linear-gradient(90deg, rgba(255,255,255,0.0), rgb(194, 239, 251) 1%, rgba(255,255,255,0.0));
        border-radius: 0.15em;
    }
    #TextSearch {
		/* margin: 1.5em 0 1.5em 20px; */
        padding-top: 0.5em;
        position: relative;
        margin-left: 1.5em;
        margin-top: 1em;
    }
    #hitlist {
        padding-bottom: 1em;
        margin-bottom: 0;
    }
	#TextSearch input {
        -webkit-appearance: none;
        appearance: none;
        border: 1px solid gray;
        max-width: 11em;
		font-size: larger;
		padding: 0 0.5em;
		margin-right: 0.5em;
	}
    #checkButton {
        color: black;
        background-color: khaki;
        border-radius: 0.2em;
    }
    #turtle0 {
        height: 40px;
        position: absolute;
        bottom: -2px;
        right: 1em;
        animation: turtlemove 90s linear 1 forwards;
    }
    footer {
        margin-top: 0;
    }
    @keyframes turtlemove {
        0%{ transform:translateX(-0px);}
        10%{ transform:translateX(-0px);}
        100%{ transform:translateX(-350px);}
    }
    @media (max-width: 840px) {
        #catchphrase {
            font-size: 1rem;
        }
        #movie {
            width: 100%;
            margin-bottom: 10px;
        }
        /* 検索 */
        #TextSearch {
            margin-left: 15px;
        }
        #wordText, #checkButton {
            font-size: 16px;
        }
        #turtle0 {
            display: none;
        }
    }
</style>
<body>
 
<!-- input・label・ドロワーメニューはbody直下 -->
<input id="check_input" type="checkbox">
<label id="menu_btn" for="check_input"> <!-- ハンバーガーボタン部分 -->
    <span></span><div id="title">MENU</div>
</label>
<label id="drawer_back" for="check_input"></label> <!-- ドロワーメニューの背景部分 -->

<div id="menu_cont"> <!-- ドロワーメニュー本体部分 -->
    <ul>
        <li><a href="index.html">TOP</a></li>
        <li><a href="intro.html">経緯と方針</a></li>
        <li><a href="menu.html">飼育環境</a></li>
        <li><a href="maintenance.html">日々の管理</a></li>
        <li><a href="trouble.html">トラブル</a></li>
        <li><a href="baby.html">成長記録</a></li>
    </ul>
    <ul id="menu2nd">
        <li>&nbsp;</li>
        <li><a href="https://www.instagram.com/ishigame65/">Instagram<img src="img/insta60.png" alt="" id="instaicon"></a></li>
        <li><a href="keeper.html">飼育係</a></li>
        <li><a href="entertainment.html">遊び</a></li>
        <li><a href="links.html">リンク</a></li>
        <li><a href="copyright.html">サイトポリシー</a></li>
        <li><a href="sitemap.html">サイトマップ</a></li>
    </ul>
</div>

<header>
    <h1><a href="index.html"><img id="logo" src="img/logo.png" alt="Ishigame65"></a></h1>
    <nav>
        <ul>
            <li><a href="intro.html">経緯と方針</a></li>
            <li><a href="menu.html">飼育環境</a></li>
            <li><a href="maintenance.html">日々の管理</a></li>
            <li><a href="trouble.html">トラブル</a></li>
            <li><a href="baby.html">成長記録</a></li>
        </ul>    
    </nav>
</header>

<div id="wrapper"> <!-- コンテンツ部分をdivで囲む　input要素と同じ階層に配置する -->
    <main>
        <section id="movies">
            <div id="main_movie">
                <video id="movie" src="img/igwm01s.mp4" controls muted playsinline loop poster="img/igwm01s_0.jpg" onclick="this.play();"></video>
                <h2 id="catchphrase">イシガメが快適に暮らす環境を作る</h2>
                <div id="buttons">
                    <button id="auto" onclick="autoSwitch()">▶</button>
                    <button id="mbut0" onclick="mChange(0)">1</button>
                    <button id="mbut1" onclick="mChange(1)">2</button>
                    <button id="mbut2" onclick="mChange(2)">3</button>
                    <button id="mbut3" onclick="mChange(3)">4</button>
                    <button id="mbut4" onclick="mChange(4)">5</button>
                    <button id="mbut5" onclick="mChange(5)">6</button>
                </div>
            </div>
        </section>
        <section id="search">
            <div id="TextSearch">
                <!-- <img id="turtles" class="floatright" src="img/turtle.png"> -->
                <small>1つの語句を入力してサイト内を[検索]</small>
                <p>
                    <label><input type="text" id="wordText"></label>
                    <!-- <label><input type="text" id="wordText" maxlength="5" required></label> -->
                    <input type="button" value="検索" id="checkButton">
                </p>
                <p id="msg"></p>
                <p id="hitlist"></p>
                <img id="turtle0" src="img/turtle0.png">
            </div>
        </section>
    </main>
    <footer> <!-- フッターコンテンツ -->
        <a href="https://www.instagram.com/ishigame65/"><img src="img/insta60.png" alt="" id="instaicon2"></a>
        <div id="footlinks">
            <ul>
                <li><a href="keeper.html">飼育係</a></li>
                <li><a href="entertainment.html">遊び</a></li>
                <li><a href="links.html">リンク</a></li>
                <li><a href="copyright.html">サイトポリシー</a></li>
                <li><a href="sitemap.html">サイトマップ</a></li>
            </ul>
        </div>
        <a href="#logo"><span class="arrow-up"></span></a>    
    </footer>
</div>
<script>
    // ToDO: 映像再生一時停止操作が効かないauto
    const mov = document.getElementById('movie');
    const phrase = document.getElementById('catchphrase');
    const auto_but = document.getElementById('auto');
    // igwm07s, igwm06s, igwm03s
    const movies = [ 'igwm01s', 'igwm05s', 'igwm02s', 'igwm04s', 'igwm09s', 'igwm08s' ];
    const buttons = [];
    for (let i = 0; i < movies.length; i++) {
        buttons.push(document.getElementById(`mbut${i}`));
    }
    function mChange(no) {
        mno = no;
        for (let i = 0; i < movies.length; i++) {
            buttons[i].style.background = 'khaki';
        }
        buttons[mno].style.background = 'DeepSkyBlue';
        mov.src = 'img/' + movies[mno] + '.mp4';
        mov.poster = 'img/' + movies[mno] + '_0.jpg';
    }
    let mno = 0;
    let timer = null;
    function autoSwitch() {
        if (timer == null) {
            timer = setInterval( function(){
                mChange((mno + 1) % movies.length);
            }, 8000);
            // auto_but.innerText = '⏸';
            auto_but.textContent = '⏸';
        } else {
            clearInterval(timer);
            timer = null;
            // auto_but.innerText = '▶';
            auto_but.textContent = '▶';
        }
    }
    // 映像初期状態だけモノクロにする
    mov.addEventListener("play", atplay);
    function atplay() {
        clearInterval(timer);
        timer = null;
        // auto_but.innerText = '▶';
        auto_but.textContent = '▶';
        phrase.style.display = "none";
        mov.style.filter = 'none';  // モノクロ解除
        mov.style.transition = '10s';
    }
</script>

<!-- 検索 -->
<script src='js/search.js'></script>
<script>
	function butClick(){
        //   var turtles_el = document.getElementById('turtles');
        //   turtles_el.style.opacity = '1.0';
        var turtle0_el = document.getElementById('turtle0');
        turtle0_el.style.animation = 'none';
        turtle0_el.style.right = '1em';

        var msg_el = document.getElementById('msg');
	    var hitlist_el = document.getElementById('hitlist');
	  
	    var result = searchData(wordText.value);
	    msg_el.innerHTML = '<b>' + result.length + '</b> 件見つかりました（' + i_body.length + '件中）';

	    var html = createHtml(result);
	    hitlist_el.innerHTML = html;
	}

	function searchData(query) {
	  var result = [];
	  query = query.trim();
	  if (query.length < 1) {
		return result;
	  }
	  var re = new RegExp(query, 'i');
	  for (var i = 0; i < i_body.length; ++i) {
		var pos = i_body[i].search(re);
		if (pos != -1) {
			result.push([i, pos, pos + query.length]);
		}
	  }
	  return result;
	}

	function createHtml(result) {
	  var htmls = [];
	  for (var i = 0; i < result.length; ++i) {
		var index = result[i][0];
		var start = result[i][1];
		var end = result[i][2];
		var url = i_url[index];
		var title = i_title[index];
		var body = i_body[index]
		htmls.push(createEntry(url, title, body, start, end));
	  }
	  return htmls.join('');
	}

	function createEntry(url, title, body, start, end) {
	  return '<div class=\"item\">' +
		  '<a class=\"item_title\" href=\"' + url + '\" target=\"_parent\">' + title + '</a>' +
		  '<blockquote>' + excerpt(body, start, end) + '</blockquote>' +
		  '</div>';
	}

	function excerpt(body, start, end) {
	  var head = body.substring(start - 80, start);
	  pos = head.lastIndexOf('<br>');
	  if (pos != -1) {
		next_pos = head.lastIndexOf('<br>', pos - 1);
		if (next_pos != -1) {
		  pos = next_pos
		}
		head = head.substring(pos + 4)
	  }
	  var tail = body.substring(end, end + 180);
	  pos = tail.indexOf('<br>');
	  if (pos != -1) {
		next_pos = tail.indexOf('<br>', pos + 1);
		if (next_pos != -1) {
		  pos = next_pos
		  next_pos = tail.indexOf('<br>', pos + 1);
		  if (next_pos != -1) {
			pos = next_pos
		  }
		}
		tail = tail.substring(0, pos - 4)
	  }
	  return [head, '<b>', body.substring(start, end), '</b>', tail].join('');
	}
	window.onload = function() {
	    let wordText = document.getElementById('wordText');
	    let checkButton = document.getElementById('checkButton');
	    checkButton.addEventListener('click', butClick);
	}
</script>

</body>
</html>