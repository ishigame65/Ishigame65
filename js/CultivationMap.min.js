class CultivationMap{constructor(t){this.canvas=document.getElementById(t),this.canvas_width=this.canvas.clientWidth,this.canvas_height=this.canvas.clientHeight,this.ctx=this.canvas.getContext("2d"),this.dead_pat=new Image,this.dead_pat.src="./img/pluspat1.png",this.dead_color={},this.dead_area_set=[],this.plant_color={},this.plant_area_set=[],this.direction=new Image,this.direction.src="./img/direction1.png",this.area_w=100,this.area_h=100,this.basic_font="12px 'MS P Gothic'",this.set_direction(null,0,0)}set_size(t,s){this.area_w=t,this.area_h=s}set_margin(t){this.canvas.style.margin=t}set_dead_color(t,s){this.dead_color[t]=s}add_dead(t,s,i,e,a){this.dead_area_set.push({dead_name:t,x:s,y:i,w:e,h:a})}set_plant_color(t,s){this.plant_color[t]=s}set_plants(t){for(let[s,i]of Object.entries(t.get_colors()))this.plant_color[s]=i}set_basic_font(t){this.basic_font=t}add_plant(t,s,i,e,a){this.plant_area_set.push({plant_name:t,x:s,y:i,w:e,h:a})}add_plant_font(t,s,i,e,a,h){this.plant_area_set.push({plant_name:t,x:s,y:i,w:e,h:a,font:h})}draw(){for(let t=0;t<this.dead_area_set.length;t++){let s=this.dead_area_set[t];this.draw_dead_(s,this.dead_color[s.dead_name])}for(let i=0;i<this.plant_area_set.length;i++){let e=this.plant_area_set[i];this.draw_plant_(e,this.plant_color[e.plant_name])}null!=this.ang&&this.draw_direction_(this.ang,this.ang_x,this.ang_y),this.ctx.strokeStyle="black",this.ctx.strokeRect(0,0,this.canvas_width,this.canvas_height)}draw_dead_(t,s){let{x:i,y:e,w:a,h}=this.get_rect_(t);this.ctx.fillStyle=s,this.ctx.fillRect(i,e,a,h);let l=this.ctx.createPattern(this.dead_pat,"repeat");this.ctx.fillStyle=l,this.ctx.fillRect(i,e,a,h)}set_font_(t){this.ctx.font=t,this.font_size=parseInt(t.match(/(\d+)px/)[1])}draw_plant_(t,s){this.set_font_(void 0==t.font?this.basic_font:t.font),this.ctx.fillStyle=s;let{x:i,y:e,w:a,h}=this.get_rect_(t);this.ctx.fillRect(i,e,a,h),this.ctx.fillStyle="black";let l=this.ctx.measureText(t.plant_name);if(a>l.width+2){let n=i+(a-l.width)/2,c=e+(h+this.font_size)/2;this.ctx.fillText(t.plant_name,n,c)}else{let r=t.plant_name,d=Math.ceil(r.length/2),o=r.slice(0,d),x=r.slice(d),p=this.ctx.measureText(o),f=i+(a-p.width)/2,g=e+h/4+this.font_size/2,w=e+3*h/4+this.font_size/2;this.ctx.fillText(o,f,g),this.ctx.fillText(x,f,w)}}get_rect_(t){let s=this.canvas_width/this.area_w,i=this.canvas_height/this.area_h,e=t.x*s,a=t.y*i,h=t.w*s,l=t.h*i;return{x:e,y:a,w:h,h:l}}set_direction(t,s,i){this.ang=t,this.ang_x=s,this.ang_y=i}draw_direction_(t,s,i){this.ctx.save(),this.ctx.translate(25+s,25+i),this.ctx.rotate(t*Math.PI/180),this.ctx.translate(-25,-25),this.ctx.drawImage(this.direction,0,0),this.ctx.restore()}}