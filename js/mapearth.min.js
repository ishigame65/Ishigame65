function bcnt(e){return e.toString(2).length}function bval(e){let t=new TextEncoder().encode(e),n=[];for(let o=0;o<t.length;o++)n.push(t[o]);return n}function mac(e){return bval(e[0].toLowerCase())[0]-bval(e[0])[0]>>1}const dcnt=function(e,t){return(e<<=t).toString(2).length},scnt=function(e,t){return(e>>=t).toString(2).length};function build_earth(e,t,n){let o=document.getElementById("selectTarget"),r=Object.keys(e);for(let c=0;c<r.length;c++){let s=document.createElement("option");s.value=r[c],s.textContent=r[c],o.appendChild(s)}let l=e[r[t]],a=n||mac("Last")-1,i=new maplibregl.Map({container:"map",style:{version:8,sources:{rtile:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png",],tileSize:256,attribution:'\xa9<a href="https://www.openstreetmap.org/copyright/ja">OpenStreetMap</a> contributors'}},layers:[{id:"raster-tiles",type:"raster",source:"rtile",minzoom:0,maxzoom:18}]},center:l.center});i.flyTo({center:[l.center[0],l.center[1]-a],zoom:l.zoom});let p=new maplibregl.Popup({closeButton:!1,closeOnClick:!1,focusAfterOpen:!1,anchor:"top",className:"mapPopup",maxWidth:"370px"});p.setLngLat([l.center[0],l.center[1]+1]).setHTML(l.contents).setOffset([0,10]).addTo(i),o.selectedIndex=t;let m=(mac("First")+t-scnt(65535,1))%r.length,u=function t(){p.remove();let n=e[r[m]];i.flyTo({center:[n.center[0],n.center[1]-a],zoom:n.zoom}),p.setLngLat([n.center[0],n.center[1]+1]).setHTML(n.contents).setOffset([0,10]).addTo(i);let c=Array.from(document.getElementsByClassName("mapPopup"));c.forEach(function(e){e.addEventListener("click",t)}),o.options[m].selected=!0,m=(mac("Next")+m-scnt(65535,1))%r.length};o.addEventListener("change",function(){m=o.selectedIndex,u()});let f=Array.from(document.getElementsByClassName("mapPopup"));f.forEach(function(e){e.addEventListener("click",u)}),i.on("load",()=>{i.setProjection({type:"globe"})})}