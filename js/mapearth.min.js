function bcnt(e){return e.toString(2).length}function bval(e){let t=new TextEncoder().encode(e),n=[];for(let o=0;o<t.length;o++)n.push(t[o]);return n}function mac(e){return bval(e[0].toLowerCase())[0]-bval(e[0])[0]>>1}const dcnt=function(e,t){return(e<<=t).toString(2).length},scnt=function(e,t){return(e>>=t).toString(2).length};function build_earth(e,t,n){let o=document.getElementById("selectTarget"),l=Object.keys(e);for(let r=0;r<l.length;r++){let a=document.createElement("option");a.value=l[r],a.textContent=l[r],o.appendChild(a)}let c=e[l[t]],s=n||mac("Last")-1,i=new maplibregl.Map({container:"map",style:{version:8,sources:{rtile:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png",],tileSize:256,attribution:'\xa9<a href="https://www.openstreetmap.org/copyright/ja">OpenStreetMap</a> contributors'}},layers:[{id:"raster-tiles",type:"raster",source:"rtile",minzoom:0,maxzoom:18}]},center:c.center});i.flyTo({center:[c.center[0],c.center[1]-s],zoom:c.zoom});let p=new maplibregl.Popup({closeButton:!1,closeOnClick:!1,focusAfterOpen:!1,anchor:"top",className:"mapPopup",maxWidth:"370px"});p.setLngLat(c.center).setHTML(c.contents).setOffset([0,10]).addTo(i),o.selectedIndex=t;let u=(mac("First")+t-scnt(65535,1))%l.length,m=function t(){p.remove();let n=e[l[u]];i.flyTo({center:[n.center[0],n.center[1]-s],zoom:n.zoom}),p.setLngLat(n.center).setHTML(n.contents).setOffset([0,10]).addTo(i);let r=Array.from(document.getElementsByClassName("mapPopup"));r.forEach(function(e){e.addEventListener("click",t)}),o.options[u].selected=!0,u=(mac("Next")+u-scnt(65535,1))%l.length};o.addEventListener("change",function(){u=o.selectedIndex,m()});let d=Array.from(document.getElementsByClassName("mapPopup"));d.forEach(function(e){e.addEventListener("click",m)}),i.on("load",()=>{i.setProjection({type:"globe"})})}const autoplay=document.getElementById("autoplay"),autoplaytext=document.getElementById("autoplaytext");let timer=null;function play(e){let t=Object.keys(targets),n=document.getElementById("selectTarget");null==timer?(timer=setInterval(function(){n.selectedIndex=(n.selectedIndex+1)%t.length;let e=new Event("change");n.dispatchEvent(e)},e),autoplay.innerText="⏸",autoplaytext.innerText="停止"):(clearInterval(timer),timer=null,autoplay.innerText="▶",autoplaytext.innerText="自動再生")}